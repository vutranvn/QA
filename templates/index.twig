<div id="stream_analyzer">
	<div class="row">
		<div class="col s12 m12 l12 offset-l1 row-block row-one">
				<div class="row btn-group text-center">
					<div class="col m3 block-btn click-me" data-src="{{ urlSparklineAudience }}">
						<span>{{ 'QualityAssurance_AudienceSize'|translate }}</span>
						<div class="widgetContent ng-scope">
							<div class='overview-widget-ausize-widget' data-refreshAfterXSecs="{{ refreshAfterXSecs }}" data-last-minutes="{{ lastMinutes }}" data-translations="{{ translations|json_encode }}">
								<div class='overview-widget-ausize-counter' title="">
									<div>{{ audience_size }}</div>
								</div>
							</div>
							<script type="text/javascript">$(document).ready(function () {require('piwik/QualityAssurance').initOverviewGetRowOne();});</script>
						</div>
					</div>

					<div class="col m3 block-btn click-me wait" data-src="{{ urlSparklineStartup }}">
						<span>{{ 'QualityAssurance_StartUpTime'|translate }}</span>
						<div class="widgetContent ng-scope">
							<div class='overview-widget-startup_time-widget' data-refreshAfterXSecs="{{ refreshAfterXSecs }}" data-last-minutes="{{ lastMinutes }}" data-translations="{{ translations|json_encode }}">
								<div class='overview-widget-startup_time-counter' title="">
									<div>{{ startup_time }} ms</div>
								</div>
							</div>
							<script type="text/javascript">$(document).ready(function () {require('piwik/QualityAssurance').initOverviewGetRowOneSU();});</script>
						</div>
					</div>

					<div class="col m3 block-btn click-me wait" data-src="{{ urlSparklineBitRate }}">
						<span>{{ 'QualityAssurance_Bitrate'|translate }}</span>
						<div class="widgetContent ng-scope">
							<div class='overview-widget-bitrate-widget' data-refreshAfterXSecs="{{ refreshAfterXSecs }}" data-last-minutes="{{ lastMinutes }}" data-translations="{{ translations|json_encode }}">
								<div class='overview-widget-bitrate-counter' title="">
									<div>{{ bitrate }} kbit/s</div>
								</div>
							</div>
							<script type="text/javascript">$(document).ready(function () {require('piwik/QualityAssurance').initOverviewGetRowOneBR();});</script>
						</div>
					</div>

					<div class="col m3 block-btn click-me wait" data-src="{{ urlSparklineRebuffer }}">
						<span>{{ 'QualityAssurance_Buffering'|translate }}</span>
						<div class="widgetContent ng-scope">
							<div class='overview-widget-buffer_time-widget' data-refreshAfterXSecs="{{ refreshAfterXSecs }}" data-last-minutes="{{ lastMinutes }}" data-translations="{{ translations|json_encode }}">
								<div class='overview-widget-buffer_time-counter' title="">
									<div>{{ buffer_time }}%</div>
								</div>
							</div>
							<script type="text/javascript">$(document).ready(function () {require('piwik/QualityAssurance').initOverviewGetRowOneBT();});</script>
						</div>
					</div>

					<div class="col m3 block-btn click-me wait" data-src="{{ urlSparklinePlayRequested }}">
						<span>{{ 'QualityAssurance_PlayRequested'|translate }}</span>
						<div class="widgetContent ng-scope">
							<div class='overview-widget-play_requested-widget' data-refreshAfterXSecs="{{ refreshAfterXSecs }}" data-last-minutes="{{ lastMinutes }}" data-translations="{{ translations|json_encode }}">
								<div class='overview-widget-play_requested-counter' title="">
									<div>{{ play_requested }}</div>
								</div>
							</div>
							<script type="text/javascript">$(document).ready(function () {require('piwik/QualityAssurance').initOverviewGetRowOnePR();});</script>
						</div>
					</div>

					<div class="col m3 block-btn click-me wait" data-src="{{ urlSparklineStreamingSpeed }}">
						<span>{{ 'QualityAssurance_StreamingSpeed'|translate }}</span>
						<div class="widgetContent ng-scope">
							<div class='overview-widget-streaming_speed-widget' data-refreshAfterXSecs="{{ refreshAfterXSecs }}" data-last-minutes="{{ lastMinutes }}" data-translations="{{ translations|json_encode }}">
								<div class='overview-widget-streaming_speed-counter' title="">
									<div>{{ streaming_speed }} bps</div>
								</div>
							</div>
							<script type="text/javascript">$(document).ready(function () {require('piwik/QualityAssurance').initOverviewGetRowOneSS();});</script>
						</div>
					</div>

					<div class="col m3 block-btn click-me wait" data-src="{{ urlSparklineSuccessfulAttempt }}">
						<span>{{ 'QualityAssurance_SuccessfulAttempt'|translate }}</span>
						<div class="widgetContent ng-scope">
							<div class='overview-widget-successful_attempt-widget' data-refreshAfterXSecs="{{ refreshAfterXSecs }}" data-last-minutes="{{ lastMinutes }}" data-translations="{{ translations|json_encode }}">
								<div class='overview-widget-successful_attempt-counter' title="">
									<div>{{ successful_attempt }}%</div>
								</div>
							</div>
							<script type="text/javascript">$(document).ready(function () {require('piwik/QualityAssurance').initOverviewGetRowOneSA();});</script>
						</div>
					</div>

					<div class="col m3 block-btn click-me wait" data-src="{{ urlSparklineCdnHit }}">
						<span>{{ 'QualityAssurance_CdnHit'|translate }}</span>
						<div class="widgetContent ng-scope">
							<div class='overview-widget-cdn_hit-widget' data-refreshAfterXSecs="{{ refreshAfterXSecs }}" data-last-minutes="{{ lastMinutes }}" data-translations="{{ translations|json_encode }}">
								<div class='overview-widget-cdn_hit-counter' title="">
									<div>{{ cdn_hit }}%</div>
								</div>
							</div>
							<script type="text/javascript">$(document).ready(function () {require('piwik/QualityAssurance').initOverviewGetRowOneCH();});</script>
						</div>
					</div>

					<div class="col m3 block-btn click-me wait" data-src="{{ urlSparklineCdnDelay }}">
						<span>{{ 'QualityAssurance_CdnDelay'|translate }}</span>
						<div class="widgetContent ng-scope">
							<div class='overview-widget-cdn_delay-widget' data-refreshAfterXSecs="{{ refreshAfterXSecs }}" data-last-minutes="{{ lastMinutes }}" data-translations="{{ translations|json_encode }}">
								<div class='overview-widget-cdn_delay-counter' title="">
									<div>{{ cdn_delay }} ms</div>
								</div>
							</div>
							<script type="text/javascript">$(document).ready(function () {require('piwik/QualityAssurance').initOverviewGetRowOneCD();});</script>
						</div>
					</div>
				</div>
			</div>

		<div class="col m12 row-block block-border row-two">
			<h2 style="visibility: hidden" data-graph-id="QualityAssurance.graphOverview"></h2>
			{{ graphOverview|raw }}
		</div>

		<script type="text/javascript">
			window.initializeGraphOverview = function () {
				var sparklineUrlParamsToIgnore = ['module', 'action', 'idSite', 'period', 'date', 'viewDataTable'];

				$("[data-graph-id]").each(function () {
					var graph = $(this);

					// try to find sparklines and add them clickable behaviour
					graph.parent().parent().find('div.click-me').each(function () {

						// find the sparkline and get it's src attribute
						var sparklineUrl = $(this).attr('data-src');

						if (sparklineUrl != "") {
							var params = broadcast.getValuesFromUrl(sparklineUrl);
							for (var i = 0; i != sparklineUrlParamsToIgnore.length; ++i) {
								delete params[sparklineUrlParamsToIgnore[i]];
							}
							for (var key in params) {
								if (typeof params[key] == 'undefined') {
									// this happens for example with an empty segment parameter
									delete params[key];
								} else {
									params[key] = decodeURIComponent(params[key]);
								}
							}

							// on click, reload the graph with the new url
							$(this).off('click.click-me');
							$(this).on('click.click-me', function () {
								$(".click-me").each( function () {
									if (!$(this).hasClass('wait')) {
										$(this).addClass('wait');
									}
								});

								if ($(this).hasClass('wait')) {
									$(this).removeClass('wait');
								}
								var reportId = graph.attr('data-graph-id'),
									dataTable = $(require('piwik/UI').DataTable.getDataTableByReport(reportId));

								// when the metrics picker is used, the id of the data table might be updated (which is correct behavior).
								// for example, in goal reports it might change from GoalsgetEvolutionGraph to GoalsgetEvolutionGraph1.
								// if this happens, we can't find the graph using $('#'+idDataTable+"Chart");
								// instead, we just use the first evolution graph we can find.
								if (dataTable.length == 0) {
									if ($(this).closest('.widget').length) {
										dataTable = $(this).closest('.widget').find('div.dataTableVizEvolution');
									} else {
										dataTable = $('div.dataTableVizEvolution');
									}
								}

								// reload the datatable w/ a new column & scroll to the graph
								dataTable.trigger('reload', params);
							});
						}
					});
				});
			};
			$(function() { initializeGraphOverview(); });
		</script>

		<div class="col m12 row-block row-three">
			<div class="row">
				<div class="col m6 block-border">
					<h3 class="title">{{ 'QualityAssurance_AudienceByFormat'|translate }}</h3>
					{% include "@QualityAssurance/_for.twig" %}
				</div>
				<div class="col m6 block-border">
					<h3 class="title">{{ 'QualityAssurance_AudienceByGeoraphy'|translate }}</h3>
					{{ audienceOfGeo|raw }}
				</div>
			</div>
		</div>

		<div class="col m12 row-block row-four">
			<div class="row">
				<div class="col m6 block-border">
					<h3 class="title">{{ 'QualityAssurance_AudienceByCategory'|translate }}</h3>
					{% include "@QualityAssurance/_cat.twig" %}
				</div>
				<div class="col m6 block-border">
					<h3 class="title">{{ 'QualityAssurance_AudienceByConnectionSpeed'|translate }}</h3>
					{% include "@QualityAssurance/_con.twig" %}
				</div>
			</div>
		</div>
	</div>
</div>

